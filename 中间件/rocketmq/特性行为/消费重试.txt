消费重试策略概述

消费重试
消费者在消费某条消息失败后，mq服务端会根据重试策略重新消费该消息，超过一定次数后若还未消费成功，则该消息将不再继续重试，直接被发送到死信队列中

触发条件
1.消费失败，包括消费者返回消息失败状态标识或抛出非预期异常
2.消息处理超时，包括在PushConsumer中排队超时

消息重试策略主要行为
重试过程状态机：控制消息在重试流程中的状态和变化逻辑
重试间隔：上一次消费失败或超时后，下次重新尝试消费的间隔时间
最大重试次数：消息可被重试消费的最大次数

消费失败时，消息被投递到专属的重试队列（队列名格式：%RETRY% + 消费者组名），等待下一次重新消费，并且msgId不变
消费者拉取重试队列中的消息，将重试消息的topic进行还原（消息的内部属性包含topic），再由业务逻辑处理

==================================PushConsumer消费重试策略==================================
重试状态机
PushConsumer消费消息时，消息的几个主要状态如下：

Ready
已就绪状态。消息在Apache RocketMQ服务端已就绪，可以被消费者消费

Inflight
处理中状态。消息被消费者客户端获取，处于消费中还未返回消费结果的状态

WaitingRetry
待重试状态，PushConsumer独有的状态。当消费者消息处理失败或消费超时，会触发消费重试逻辑判断。如果当前重试次数未达到最大次数，则该消息变为待重试状态，经过重试间隔后，消息将重新变为已就绪状态可被重新消费。多次重试之间，可通过重试间隔进行延长，防止无效高频的失败

Commit
提交状态。消费成功的状态，消费者返回成功响应即可结束消息的状态机

DLQ
死信状态。消费逻辑的最终兜底机制，若消息一直处理失败并不断进行重试，直到超过最大重试次数还未成功，此时消息不会再重试，会被投递至死信队列。您可以通过消费死信队列的消息进行业务恢复

消息重试过程中，两次消费间的间隔时间=消费耗时+重试间隔控制

最大重试次数
PushConsumer的最大重试次数由消费者分组创建时的元数据控制
例如，最大重试次数为3次，则该消息最多可被投递4次，1次为原始消息，3次为重试投递次数

重试间隔时间
无序消息（非顺序消息）：重试间隔为阶梯时间，如下
10s -> 30s -> 1min -> 2min -> 3min -> .... -> 10min -> 20min -> 30min -> 1h -> 2h -> 2h
顺序消息：重试间隔为固定时间

